(this["webpackJsonpreact-app-oidc"]=this["webpackJsonpreact-app-oidc"]||[]).push([[0],{25:function(e,t,n){e.exports=n(38)},30:function(e,t,n){},32:function(e,t,n){},38:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(18),o=n.n(i),s=n(13),c=(n(30),n(5)),u=n(6),l=n.n(u),d=n(8),g=n(10),h=n(11),p=n(23),m=n(19),v=n(24),f=(n(32),n(20)),k=function(){function e(){Object(g.a)(this,e)}return Object(h.a)(e,null,[{key:"init",value:function(e){var t=this;this.userManager=new f.UserManager(e);var n=this.userManager.events;return n.addUserLoaded(this.onUserLoaded),n.addSilentRenewError(this.onError),n.addUserUnloaded(this.onUserUnloaded),n.addUserSignedOut(this.onUserUnloaded),n.addAccessTokenExpired(this.onAccessTokenExpired),document.location.toString().includes("".concat(e.redirect_uri))?this.userManager.signinRedirectCallback().then((function(e){e.state.url&&(document.location=e.state.url)})).then((function(){return t.userManager.getUser().then((function(e){return{type:"callback",user:e}}))})):document.location.toString().includes(e.silent_redirect_uri)?this.userManager.signinSilentCallback().then((function(){return{type:"callback"}})):this.userManager.getUser().then((function(e){return t.state.oidcUser=e,{type:"user",oidcUser:e}}))}},{key:"getUserManager",value:function(){return this.userManager}},{key:"getState",value:function(){return this.state}},{key:"onUserLoaded",value:function(e){this.state={oidcUser:e}}},{key:"onUserUnloaded",value:function(){this.state={oidcUser:null}}},{key:"onAccessTokenExpired",value:function(){return this.state={oidcUser:null},this.userManager.signinSilent()}},{key:"onError",value:function(e){this.state={oidcUser:e}}},{key:"logout",value:function(){if(this.state={oidcUser:null},this.userManager){var e=this.userManager.events;e.removeUserLoaded(this.onUserLoaded),e.removeSilentRenewError(this.onError),e.removeUserUnloaded(this.onUserUnloaded),e.removeUserSignedOut(this.onUserUnloaded),e.removeAccessTokenExpired(this.onAccessTokenExpired)}}},{key:"signinSilent",value:function(){return this.state={oidcUser:null},this.userManager.signinSilent()}},{key:"signinRedirect",value:function(e){return e||(e=document.location.toString()),this.userManager.signinRedirect({state:{url:e}})}}]),e}();k.userManager=void 0,k._document=document,k.state={oidcUser:null};var U={client_id:"https://api.hel.fi/auth/berths",redirect_uri:"https://zeukkari.github.io/react-app-oidc/callback/",response_type:"id_token token",post_logout_redirect_uri:"https://zeukkari.github.io/react-app-oidc/",scope:"openid https://api.hel.fi/auth/berths https://api.hel.fi/auth/helsinkiprofile",authority:"http://tunnistamo-backend:8000",silent_redirect_uri:"https://zeukkari.github.io/react-app-oidc/silent_callback/",automaticSilentRenew:!0,loadUserInfo:!0},b=function(e){function t(e){var n;return Object(g.a)(this,t),(n=Object(p.a)(this,Object(m.a)(t).call(this,e))).state={user:void 0,isLoggedIn:!1,meta:{date:new Date,timerID:null}},n}return Object(v.a)(t,e),Object(h.a)(t,[{key:"triggerLogin",value:function(){console.log("init auth",U),k.init(U).then((function(e){console.log("status: ",e),"callback"!==e.type&&(e.user?console.log("My application started",e):k.signinRedirect())}))}},{key:"triggerLogout",value:function(){!function(){var e;l.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("trigger logout"),t.next=3,l.a.awrap(k.userManager.getUser());case 3:e=t.sent,console.log("user: ",e),null!=e&&k.getUserManager().signoutRedirect();case 6:case"end":return t.stop()}}))}()}},{key:"tick",value:function(){this.setState((function(e){return Object(d.a)({},e,{meta:{timerID:e.meta.timerID,date:new Date}})}))}},{key:"componentDidMount",value:function(){var e,t,n,r=this;return l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return e=function(e){return r.setState((function(t){var n;return Object(d.a)({},t,{error:{},user:e,isLoggedIn:void 0!==(null===(n=e.oidcUser)||void 0===n?void 0:n.id_token)})}))},t=function(e){return r.setState((function(t){var n;return Object(d.a)({},t,{error:e,user:{},isLoggedIn:void 0!==(null===(n=e.oidcUser)||void 0===n?void 0:n.id_token)})}))},console.log("OidcManager.getUserManager().state: ",k.getState()),a.prev=3,a.next=6,l.a.awrap(k.init(U));case 6:n=a.sent,console.log("result: ",n),e(n),a.next=17;break;case 11:return a.prev=11,a.t0=a.catch(3),console.error(a.t0),t(a.t0.toString()),a.next=17,l.a.awrap(k.getUserManager().clearStaleState());case 17:this.setState((function(e){return Object(d.a)({},e,{meta:Object(d.a)({},e.meta,{timerID:setInterval((function(){return r.tick()}),1e3)})})}));case 18:case"end":return a.stop()}}),null,this,[[3,11]])}},{key:"componentWillUnmount",value:function(){clearInterval(this.state.meta.timerID)}},{key:"render",value:function(){var e,t,n=this;return a.a.createElement("div",{className:"App"},a.a.createElement("div",null,this.state.isLoggedIn&&a.a.createElement("h2",null,"Hello ".concat(null===(e=this.state.user)||void 0===e?void 0:null===(t=e.oidcUser)||void 0===t?void 0:t.profile.name)),!this.state.isLoggedIn&&a.a.createElement("h2",null,"You are not signed in"),a.a.createElement("h2",null,"It is ",this.state.meta.date.toLocaleTimeString(),".")),a.a.createElement("span",null,a.a.createElement("button",{className:"button",disabled:this.state.isLoggedIn,onClick:function(){return n.triggerLogin()}}," Login"),a.a.createElement("button",{className:"button",disabled:!this.state.isLoggedIn,onClick:function(){return n.triggerLogout()}}," Logout ")),a.a.createElement("div",{className:"container"},a.a.createElement("div",null,a.a.createElement("h3",null,"user info: "),a.a.createElement("div",null," ",a.a.createElement("textarea",{readOnly:!0,value:JSON.stringify(this.state,null,"  ")})," ",a.a.createElement("pre",null," ")))))}}]),t}(r.Component),E=function(){return a.a.createElement("div",null,"Page not found")},y=function(){return a.a.createElement(c.c,null,a.a.createElement(c.a,{exact:!0,path:"/",component:b}),a.a.createElement(c.a,{path:"/callback",component:b}),a.a.createElement(c.a,{component:E}))};o.a.render(a.a.createElement(s.a,null,a.a.createElement(y,null)),document.getElementById("root"))}},[[25,1,2]]]);
//# sourceMappingURL=main.95bfa0f3.chunk.js.map